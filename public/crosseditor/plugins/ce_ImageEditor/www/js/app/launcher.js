define("app/lib/cache",["underscore"],function(e){var t=function(){this.init()};return t.prototype={init:function(){this.__data__={}},clear:function(){this.init()},get:function(e,t){if(this.__data__[e])return this.__data__[e][t]},set:function(t,n,i){if(t&&n&&i){this.__data__[t]=this.__data__[t]||{};var r={};r[n]=i,e.extend(this.__data__[t],r)}}},new t}),define("app/lib/promise",[],function(){function e(){}function t(e){setTimeout(e,0)}function n(e){try{return e.then}catch(e){return h=e,g}}function i(e,t){try{return e(t)}catch(e){return h=e,g}}function r(e,t,n){try{e(t,n)}catch(e){return h=e,g}}function a(t){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._deferredState=0,this._state=0,this._value=null,this._deferreds=null,t!==e&&f(t,this)}function s(t,n,i){return new t.constructor(function(r,s){var l=new a(e);l.then(r,s),o(t,new p(n,i,l))})}function o(e,t){for(;3===e._state;)e=e._value;if(a._onHandle&&a._onHandle(e),0===e._state)return 0===e._deferredState?(e._deferredState=1,void(e._deferreds=t)):1===e._deferredState?(e._deferredState=2,void(e._deferreds=[e._deferreds,t])):void e._deferreds.push(t);l(e,t)}function l(e,n){t(function(){var t=1===e._state?n.onFulfilled:n.onRejected;if(null===t)return void(1===e._state?c(n.promise,e._value):d(n.promise,e._value));var r=i(t,e._value);r===g?d(n.promise,h):c(n.promise,r)})}function c(e,t){if(t===e)return d(e,new TypeError("A promise cannot be resolved with itself."));if(t&&("object"==typeof t||"function"==typeof t)){var i=n(t);if(i===g)return d(e,h);if(i===e.then&&t instanceof a)return e._state=3,e._value=t,void u(e);if("function"==typeof i)return void f(i.bind(t),e)}e._state=1,e._value=t,u(e)}function d(e,t){e._state=2,e._value=t,a._onReject&&a._onReject(e,t),u(e)}function u(e){if(1===e._deferredState&&(o(e,e._deferreds),e._deferreds=null),2===e._deferredState){for(var t=0;t<e._deferreds.length;t++)o(e,e._deferreds[t]);e._deferreds=null}}function p(e,t,n){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=n}function f(e,t){var n=!1,i=r(e,function(e){n||(n=!0,c(t,e))},function(e){n||(n=!0,d(t,e))});n||i!==g||(n=!0,d(t,h))}var h=null,g={};return a._onHandle=null,a._onReject=null,a._noop=e,a.prototype.then=function(t,n){if(this.constructor!==a)return s(this,t,n);var i=new a(e);return o(this,new p(t,n,i)),i},a.all=function(e){var t=Array.prototype.slice.call(e);return new a(function(e,n){function i(s,o){if(o&&("object"==typeof o||"function"==typeof o)){var l=o.then;if("function"==typeof l){return void new a(l.bind(o)).then(function(e){i(s,e)},n)}}t[s]=o,0==--r&&e(t)}if(0===t.length)return e([]);for(var r=t.length,s=0;s<t.length;s++)i(s,t[s])})},a.resolve=function(e){return new a(function(t){t(e)})},a.race=function(e){return new a(function(t,n){e.forEach(function(e){a.resolve(e).then(t,n)})})},a.prototype.catch=function(e){return this.then(null,e)},a.prototype.done=function(e,t){(arguments.length?this.then.apply(this,arguments):this).then(null,function(e){setTimeout(function(){throw e},0)})},window.Promise=window.Promise||a,a}),define("app/lib/lang",["jquery","underscore","app/lib/cache","app/lib/promise"],function(e,t,n,i){var r=function(){};return r.prototype={__language_data__:{},defaultLang:"ko",currentLang:"ko",load:function(e){},reset:function(e){var t=this;e=e||this.currentLang,t.init({langCode:e}).then(function(){t.apply()})},apply:function(n){n=n||"";var i=this,r=function(n){return function(){e(n+" [data-cps-lang]").css("visibility","hidden"),e(n+" [data-cps-lang]").each(function(n,r){var a=e(this);if(!a.data("cps-lang-org")){var s=a.text();"INPUT"==r.nodeName&&"button"==r.type&&(s=a.attr("value")),a.data("cps-lang-org",s)}var o=a.data("cps-lang"),l=i.get(o);"string"!=typeof l&&(l=""),l=l||a.data("cps-lang-org");var c=a.data("cps-lang-type")||"text",d=c.split(",");l&&t.each(d,function(e){"function"==typeof i.applyTypeDefinitions[e]&&i.applyTypeDefinitions[e](a,l)})}),e(n+" [data-cps-lang]").css("visibility","visible")}}(n);setTimeout(function(){r()},0)},applyTypeDefinitions:{text:function(e,t){return e.text(t)},title:function(e,t){return e.attr("title",t)},alt:function(e,t){return e.attr("alt",t)}},init:function(t,n){e("style[data-cps-style-lang]").remove();var r=e('<style type="text/css" data-cps-style-lang="true"></style>');e("head").append(r),t=t||{};var a=t.langCode||this.defaultLang;this.currentLang=a;var s=this;if(e(" [data-cps-lang]").css("visibility","hidden"),s.__language_data__[a])return i.resolve(!0);var o=NHIE.lib.requirePromise(["resources/lang/lang-"+a+".js"]);return o.then(function(){return NHIE.lib.requirePromise(["text!resources/lang/css/style-"+a+".css"])}).then(function(e){var t=e[0];r.get(0).textContent=t}),o},get:function(e){if(e){var t=this.currentLang||this.defaultLang,i=e.split("|")[0],r=this.__language_data__[t];if(r){if(!n.get("lang_"+t,i)){for(var a=r,s=i.split("."),o=0,l=s.length;o<l;o++){if(!a[s[o]])return null;a=a[s[o]]}if(!a)return null;n.set("lang_"+t,i,a)}return n.get("lang_"+t,i)}}},setData:function(e,n){this.__language_data__[e]=this.__language_data__[e]||{},t.extend(this.__language_data__[e],n)}},new r}),define("app/lib/agentInfo",[],function(){return function(){function e(e){function t(t){var n=e.match(t);return n&&n.length>1&&n[1]||""}function n(t){var n=e.match(t);return n&&n.length>1&&n[2]||""}var r,a=t(/(ipod|iphone|ipad)/i).toLowerCase(),o=/like android/i.test(e),l=!o&&/android/i.test(e),c=/nexus\s*[0-6]\s*/i.test(e),d=!c&&/nexus\s*[0-9]+/i.test(e),u=/CrOS/.test(e),p=/silk/i.test(e),f=/sailfish/i.test(e),h=/tizen/i.test(e),g=/(web|hpw)(o|0)s/i.test(e),m=/windows phone/i.test(e),v=(/SamsungBrowser/i.test(e),!m&&/windows/i.test(e)),w=!a&&!p&&/macintosh/i.test(e),_=!l&&!f&&!h&&!g&&/linux/i.test(e),y=n(/edg([ea]|ios)\/(\d+(\.\d+)?)/i),I=t(/version\/(\d+(\.\d+)?)/i),b=/tablet/i.test(e)&&!/tablet pc/i.test(e),E=!b&&/[^-]mobi/i.test(e),x=/xbox/i.test(e);/opera/i.test(e)?r={name:"Opera",opera:s,version:I||t(/(?:opera|opr|opios)[\s\/](\d+(\.\d+)?)/i)}:/opr\/|opios/i.test(e)?r={name:"Opera",opera:s,version:t(/(?:opr|opios)[\s\/](\d+(\.\d+)?)/i)||I}:/SamsungBrowser/i.test(e)?r={name:"Samsung Internet for Android",samsungBrowser:s,version:I||t(/(?:SamsungBrowser)[\s\/](\d+(\.\d+)?)/i)}:/Whale/i.test(e)?r={name:"NAVER Whale browser",whale:s,version:t(/(?:whale)[\s\/](\d+(?:\.\d+)+)/i)}:/MZBrowser/i.test(e)?r={name:"MZ Browser",mzbrowser:s,version:t(/(?:MZBrowser)[\s\/](\d+(?:\.\d+)+)/i)}:/coast/i.test(e)?r={name:"Opera Coast",coast:s,version:I||t(/(?:coast)[\s\/](\d+(\.\d+)?)/i)}:/focus/i.test(e)?r={name:"Focus",focus:s,version:t(/(?:focus)[\s\/](\d+(?:\.\d+)+)/i)}:/yabrowser/i.test(e)?r={name:"Yandex Browser",yandexbrowser:s,version:I||t(/(?:yabrowser)[\s\/](\d+(\.\d+)?)/i)}:/ucbrowser/i.test(e)?r={name:"UC Browser",ucbrowser:s,version:t(/(?:ucbrowser)[\s\/](\d+(?:\.\d+)+)/i)}:/mxios/i.test(e)?r={name:"Maxthon",maxthon:s,version:t(/(?:mxios)[\s\/](\d+(?:\.\d+)+)/i)}:/epiphany/i.test(e)?r={name:"Epiphany",epiphany:s,version:t(/(?:epiphany)[\s\/](\d+(?:\.\d+)+)/i)}:/puffin/i.test(e)?r={name:"Puffin",puffin:s,version:t(/(?:puffin)[\s\/](\d+(?:\.\d+)?)/i)}:/sleipnir/i.test(e)?r={name:"Sleipnir",sleipnir:s,version:t(/(?:sleipnir)[\s\/](\d+(?:\.\d+)+)/i)}:/k-meleon/i.test(e)?r={name:"K-Meleon",kMeleon:s,version:t(/(?:k-meleon)[\s\/](\d+(?:\.\d+)+)/i)}:m?(r={name:"Windows Phone",osname:"Windows Phone",windowsphone:s},y?(r.msedge=s,r.version=y):(r.msie=s,r.version=t(/iemobile\/(\d+(\.\d+)?)/i))):/msie|trident/i.test(e)?r={name:"Internet Explorer",msie:s,version:t(/(?:msie |rv:)(\d+(\.\d+)?)/i)}:u?r={name:"Chrome",osname:"Chrome OS",chromeos:s,chromeBook:s,chrome:s,version:t(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:/edg([ea]|ios)/i.test(e)?r={name:"Microsoft Edge",msedge:s,version:y}:/vivaldi/i.test(e)?r={name:"Vivaldi",vivaldi:s,version:t(/vivaldi\/(\d+(\.\d+)?)/i)||I}:f?r={name:"Sailfish",osname:"Sailfish OS",sailfish:s,version:t(/sailfish\s?browser\/(\d+(\.\d+)?)/i)}:/seamonkey\//i.test(e)?r={name:"SeaMonkey",seamonkey:s,version:t(/seamonkey\/(\d+(\.\d+)?)/i)}:/firefox|iceweasel|fxios/i.test(e)?(r={name:"Firefox",firefox:s,version:t(/(?:firefox|iceweasel|fxios)[ \/](\d+(\.\d+)?)/i)},/\((mobile|tablet);[^\)]*rv:[\d\.]+\)/i.test(e)&&(r.firefoxos=s,r.osname="Firefox OS")):p?r={name:"Amazon Silk",silk:s,version:t(/silk\/(\d+(\.\d+)?)/i)}:/phantom/i.test(e)?r={name:"PhantomJS",phantom:s,version:t(/phantomjs\/(\d+(\.\d+)?)/i)}:/slimerjs/i.test(e)?r={name:"SlimerJS",slimer:s,version:t(/slimerjs\/(\d+(\.\d+)?)/i)}:/blackberry|\bbb\d+/i.test(e)||/rim\stablet/i.test(e)?r={name:"BlackBerry",osname:"BlackBerry OS",blackberry:s,version:I||t(/blackberry[\d]+\/(\d+(\.\d+)?)/i)}:g?(r={name:"WebOS",osname:"WebOS",webos:s,version:I||t(/w(?:eb)?osbrowser\/(\d+(\.\d+)?)/i)},/touchpad\//i.test(e)&&(r.touchpad=s)):/bada/i.test(e)?r={name:"Bada",osname:"Bada",bada:s,version:t(/dolfin\/(\d+(\.\d+)?)/i)}:h?r={name:"Tizen",osname:"Tizen",tizen:s,version:t(/(?:tizen\s?)?browser\/(\d+(\.\d+)?)/i)||I}:/qupzilla/i.test(e)?r={name:"QupZilla",qupzilla:s,version:t(/(?:qupzilla)[\s\/](\d+(?:\.\d+)+)/i)||I}:/chromium/i.test(e)?r={name:"Chromium",chromium:s,version:t(/(?:chromium)[\s\/](\d+(?:\.\d+)?)/i)||I}:/chrome|crios|crmo/i.test(e)?r={name:"Chrome",chrome:s,version:t(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:l?r={name:"Android",version:I}:/safari|applewebkit/i.test(e)?(r={name:"Safari",safari:s},I&&(r.version=I)):a?(r={name:"iphone"==a?"iPhone":"ipad"==a?"iPad":"iPod"},I&&(r.version=I)):r=/googlebot/i.test(e)?{name:"Googlebot",googlebot:s,version:t(/googlebot\/(\d+(\.\d+))/i)||I}:{name:t(/^(.*)\/(.*) /),version:n(/^(.*)\/(.*) /)},!r.msedge&&/(apple)?webkit/i.test(e)?(/(apple)?webkit\/537\.36/i.test(e)?(r.name=r.name||"Blink",r.blink=s):(r.name=r.name||"Webkit",r.webkit=s),!r.version&&I&&(r.version=I)):!r.opera&&/gecko\//i.test(e)&&(r.name=r.name||"Gecko",r.gecko=s,r.version=r.version||t(/gecko\/(\d+(\.\d+)?)/i)),r.windowsphone||!l&&!r.silk?!r.windowsphone&&a?(r[a]=s,r.ios=s,r.osname="iOS"):w?(r.mac=s,r.osname="macOS"):x?(r.xbox=s,r.osname="Xbox"):v?(r.windows=s,r.osname="Windows"):_&&(r.linux=s,r.osname="Linux"):(r.android=s,r.osname="Android");var C="";r.windows?C=function(e){switch(e){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}}(t(/Windows ((NT|XP)( \d\d?.\d)?)/i)):r.windowsphone?C=t(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i):r.mac?(C=t(/Mac OS X (\d+([_\.\s]\d+)*)/i),C=C.replace(/[_\s]/g,".")):a?(C=t(/os (\d+([_\s]\d+)*) like mac os x/i),C=C.replace(/[_\s]/g,".")):l?C=t(/android[ \/-](\d+(\.\d+)*)/i):r.webos?C=t(/(?:web|hpw)os\/(\d+(\.\d+)*)/i):r.blackberry?C=t(/rim\stablet\sos\s(\d+(\.\d+)*)/i):r.bada?C=t(/bada\/(\d+(\.\d+)*)/i):r.tizen&&(C=t(/tizen[\/\s](\d+(\.\d+)*)/i)),C&&(r.osversion=C);var N=!r.windows&&C.split(".")[0];return b||d||"ipad"==a||l&&(3==N||N>=4&&!E)||r.silk?r.tablet=s:(E||"iphone"==a||"ipod"==a||l||c||r.blackberry||r.webos||r.bada)&&(r.mobile=s),r.msedge||r.msie&&r.version>=10||r.yandexbrowser&&r.version>=15||r.vivaldi&&r.version>=1||r.chrome&&r.version>=20||r.samsungBrowser&&r.version>=4||r.whale&&1===i([r.version,"1.0"])||r.mzbrowser&&1===i([r.version,"6.0"])||r.focus&&1===i([r.version,"1.0"])||r.firefox&&r.version>=20||r.safari&&r.version>=6||r.opera&&r.version>=10||r.ios&&r.osversion&&r.osversion.split(".")[0]>=6||r.blackberry&&r.version>=10.1||r.chromium&&r.version>=20?r.a=s:r.msie&&r.version<10||r.chrome&&r.version<20||r.firefox&&r.version<20||r.safari&&r.version<6||r.opera&&r.version<10||r.ios&&r.osversion&&r.osversion.split(".")[0]<6||r.chromium&&r.version<20?r.c=s:r.x=s,r}function t(e){return e.split(".").length}function n(e,t){var n,i=[];if(Array.prototype.map)return Array.prototype.map.call(e,t);for(n=0;n<e.length;n++)i.push(t(e[n]));return i}function i(e){for(var i=Math.max(t(e[0]),t(e[1])),r=n(e,function(e){var r=i-t(e);return e+=new Array(r+1).join(".0"),n(e.split("."),function(e){return new Array(20-e.length).join("0")+e}).reverse()});--i>=0;){if(r[0][i]>r[1][i])return 1;if(r[0][i]!==r[1][i])return-1;if(0===i)return 0}}function r(t,n,r){var a=o;"string"==typeof n&&(r=n,n=void 0),void 0===n&&(n=!1),r&&(a=e(r));var s=""+a.version;for(var l in t)if(t.hasOwnProperty(l)&&a[l]){if("string"!=typeof t[l])throw new Error("Browser version in the minVersion map should be a string: "+l+": "+String(t));return i([s,t[l]])<0}return n}function a(e,t,n){return!r(e,t,n)}var s=!0,o=e("undefined"!=typeof navigator?navigator.userAgent||"":"");o.test=function(e){for(var t=0;t<e.length;++t){var n=e[t];if("string"==typeof n&&n in o)return!0}return!1},o.isUnsupportedBrowser=r,o.compareVersions=i,o.check=a,o._detect=e,o.detect=e;var l=parseFloat(o.version),c=navigator.userAgent.toLowerCase();null!=new RegExp("trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(c)&&parseFloat(RegExp.$1);return{IsIE:o.msie,IsIE6:o.msie&&l>=6&&l<7,IsIE7:o.msie&&l>=7&&l<8,IsIE8:o.msie&&l>=8&&l<9,IsIE9:o.msie&&l>=9&&l<10,IsIE10:o.msie&&l>=10&&l<11,IsIE11:o.msie&&l>=11&&l<12,IsGecko:/gecko\//.test(c),IsOpera:!!window.opera,IsSafari:/applewebkit\//.test(c)&&!/chrome\//.test(c),IsChrome:/applewebkit\//.test(c)&&/chrome\//.test(c),IsEdge:/applewebkit\//.test(c)&&/chrome\//.test(c)&&/edge\//.test(c),IsMac:/macintosh/.test(c),IsIOS5:/(ipad|iphone)/.test(c)&&c.match(/applewebkit\/(\d*)/)[1]>=534&&c.match(/applewebkit\/(\d*)/)[1]<536,IsIOS6:/(ipad|iphone)/.test(c)&&c.match(/applewebkit\/(\d*)/)[1]>=536,_bowser:o}}()}),define("app/lib",["jquery","underscore","app/lib/cache","app/lib/lang","app/lib/promise","app/lib/agentInfo"],function(e,t,n,i,r,a,s){var o=function(e){return e=e||"",n.get("template",e)||n.set("template",e,t.template(e)),n.get("template",e)},l=function(e,t){return void 0===t.lang&&(t.NHIE_Lang=NHIE.Lang),o(e)(t)},c=function(e){return new r(function(n,i){try{require(e,function(){var e=[];t.each(arguments,function(t){e.push(t)}),n(e)})}catch(e){i(e)}})},d={getFileExt:function(e){e=e||"";try{e=new URL(e).pathname.split("/").pop()}catch(e){}return e.split(".").pop()},isSupportedFileFormat:function(e){return e=e||"",["jpg","jpeg","gif","png","bmp"].indexOf(e.toLowerCase())>-1},parseRequest:function(){var e,t=/\+/g,n=/([^&=]+)=?([^&]*)/g,i=function(e){return decodeURIComponent(e.replace(t," "))},r=window.location.search.substring(1);for(urlParams={};e=n.exec(r);)urlParams[i(e[1])]=i(e[2]);return urlParams},checkBinaryFileType:function(e){return new r(function(t,n){var i=new FileReader;i.onload=function(e){t(i.result)},i.onerror=function(e){n(e)},i.readAsArrayBuffer(e)}).then(function(t){var n=new Uint8Array(t);if(!n||n.length<24)return!1;var i=104===n[20]&&101===n[21]&&105===n[22]&&99===n[23];if(console.log("is_heic?",i),i){var r=window.Promise||r;throw"ERROR_FORMAT:heic"}return e}).catch(function(e){throw e})},readFileData:function(e){return new r(function(t,n){var i=new FileReader;i.onload=function(){t(i.result)},i.onerror=function(e){n(e)},i.readAsDataURL(e)})},checkMimeData:function(e,t){var n=e.substr(5,30).split(";")[0],i=t||n.split("/").pop();console.log("check mime:",n,i);var r=window.Promise||r;return 0===n.indexOf("image/")?d.isSupportedFileFormat(i)?d.getImageByDataSrc(e):r.reject("ERROR_FORMAT:"+i):r.reject("")},getImage:function(e){return 0===e.indexOf("data:")?d.getImageByDataSrc(e):fetch(e).then(function(e){return e.blob()}).then(function(e){return d.checkBinaryFileType(e).then(d.readFileData).then(d.checkMimeData)}).catch(function(e){throw NHIE.app.loading(!1),e})},getImageByDataSrc:function(t){return new r(function(n,i){var r=e('<img style="width:30px;height:30px; crossorigin="anonymous"/>');r.attr("crossOrigin","anonymous"),r.on("load",function(){n(r.get(0))}).on("error",function(e){NHIE.app.loading(!1),console.error(e),i(e)}),r.attr("src",t)})},canvasCache:{set:function(t){var i=t.id,r=NHIE.workspace.getLayerById(i),a=0,s="";if(r.empty)s="_CACHE::empty_canvas";else do{s="_CACHE::"+i+"$"+a++}while(n.get("canvas_cache",s));var o=t.getContext("2d");n.set("canvas_cache",s,{width:t.width,height:t.height,data:o.getImageData(0,0,t.width,t.height)}),e(t).attr("data-canvascache-id",s)},get:function(e){return n.get("canvas_cache",e)}},canvasManager:{resetImageData:function(t){var n=e(t),i=n.attr("data-canvascache-id");if(i&&d.canvasCache.get(i)){var r=d.canvasCache.get(i),a=e("<canvas></canvas>"),s=a.get(0);s.width=r.width,s.height=r.height;s.getContext("2d").putImageData(r.data,0,0);var o=NHIE.lib.util.canvasManager.getCanvasModifyData(t),l={x:o.flip.h?-1:1,y:o.flip.v?-1:1},c={width:r.width,height:r.height};o.rotate%180&&(c={width:r.height,height:r.width}),t.height=c.height,t.width=c.width;var u=t.getContext("2d");u.save(),u.scale(l.x,l.y),u.translate(t.width/2*l.x,t.height/2*l.y),u.rotate(o.rotate/180*Math.PI*(l.x*l.y)),u.drawImage(s,s.width/-2*l.x,s.height/-2*l.y,s.width*l.x,s.height*l.y),u.restore(),a.remove()}},getCanvasModifyData:function(t){var n=(e(t),e(t).parent());return{rotate:parseInt(n.attr("data-modify-rotate")||"0"),flip:JSON.parse(n.attr("data-modify-flip")||'{"h":false,"v":false}')}},cropCanvas:function(e){var t,n,i,r=e.getContext("2d"),a=e.width,s=e.height,o=r.getImageData(0,0,e.width,e.height);if(console.log(a,s),!a||!s)return{};var l=[],c=[];for(n=0;n<s;n++)for(t=0;t<a;t++)i=4*(n*a+t),o.data[i+3]>0&&(l.push(t),c.push(n));l.sort(function(e,t){return e-t}),c.sort(function(e,t){return e-t});var d=l.length-1;a=l[d]-l[0],s=c[d]-c[0];var u={x:l[0]-1,y:c[0]-1,w:a+2,h:s+2};if(isNaN(u.w)||isNaN(u.h)||isNaN(u.x)||isNaN(u.y))return{};var p=r.getImageData(u.x,u.y,u.w,u.h);return e.width=u.w,e.height=u.h,r.putImageData(p,0,0),u}},getConfig:function(e){e=e||"";var t={};if("undefined"!=typeof NHIE)t=NHIE.config;else try{t=JSON.parse(s||{})}catch(e){}var n=e.split("."),i=null;if(n&&n.length){try{i=t;for(var r=0,a=n.length;r<a;r++){if(void 0===i[n[r]])return null;i=i[n[r]]}}catch(e){}if(void 0!==i)return i}},MAX_CANVAS_SIZE:1e4,getCanvasMaxWidth:function(){var e=d.getCanvasMaxSize(),t=this.getConfig("maxImageWidth");return t=t>e?e:t},getCanvasMaxHeight:function(){var e=d.getCanvasMaxSize(),t=this.getConfig("maxImageHeight");return t=t>e?e:t},getCanvasMaxSize:function(){return d.MAX_CANVAS_SIZE},rotatePoint:function(e,t,n,i,r){var a=function(e){return e/180*Math.PI};return i=i||0,r=r||0,{x:i+(t-i)*Math.cos(a(e))-(n-r)*Math.sin(a(e)),y:r+(n-r)*Math.cos(a(e))+(t-i)*Math.sin(a(e))}},getEventTargetLayer:function(t){var n=e(t.target),i=null;if(n.hasClass("tracker-handle")){i=n.parent().attr("data-target-layer-id")}else n.hasClass("layer-resizer")?i=n.attr("data-target-layer-id"):n.hasClass("layer-canvas")?i=n.attr("id"):n.hasClass("layer")&&(i=n.find("canvas").attr("id"));return NHIE.workspace.getLayerById(i)},spinner:function(t,n,i){if(!1!==n){if(i=i||{},i.color=i.color||"#000",i.size=i.size||"small",!t.find(".ui-panel-mask").length){for(var r=e('<div class="ui-spinner-mask"></div>'),a=e('<div class="spinner spinner-'+i.size+'"></div>'),s=0;s<12;s++){var o=e('<div class="spinner-stick spinner-stick-'+s+'"></div>');o.css({transform:"rotate("+30*s+"deg)",animationDelay:.1*s-1.2+"s",backgroundColor:i.color}),a.append(o)}a.css({width:40,height:40,marginLeft:-20,marginTop:-20}),r.append(a),t.append(r)}}else t.find(".ui-spinner-mask").remove()},setZoomOnEl:function(e,t){var n={zoom:t};NHIE.lib.useragent.info._bowser.firefox&&(n={transform:"scale("+t+")",transformOrigin:"0 0"}),e.css(n)},moveToCenter:function(t){if(t.scrollIntoView({block:"center",inline:"nearest"}),NHIE.lib.useragent.info.IsIE||NHIE.lib.useragent.info.IsEdge){var n=NHIE.workspace.dom,i=e(t).height();t.parentElement.parentElement.parentElement.scrollTop-=(n.clientHeight-i)/2}},adjustUploadedImageSize:function(e,t){var n=NHIE.util.getCanvasMaxWidth(),i=NHIE.util.getCanvasMaxHeight(),r=NHIE.util.getCanvasMaxSize(),a=NHIE.workspace.getSize(),s=e.naturalWidth,o=e.naturalHeight;t&&t.width&&t.height&&(s=t.width,o=t.height);var l=nw=s,c=nh=o,d=a.width,u=a.height,p=NHIE.config.option.CanvasAutoResize||0;if(1===p){l>d&&c>u&&(l>c?(l=u*l/c,c=u,l<d&&(c=d*c/l,l=d)):(c=d*c/l,l=d,c<u&&(l=u*l/c,c=u)));var f=!1;l>r&&(f=!0,nw=nh*r/c,l=r),c>r&&(f=!0,nh=nw*r/l,c=r),f&&NHIE.dialog.alert_dialog_oversizeimage.show()}else if(2===p){if(l>d||c>u){c=d*c/l,l=d;var f=!1;l>r&&(f=!0,nw=nh*r/c,l=r),c>r&&(f=!0,nh=nw*r/l,c=r),f&&NHIE.dialog.alert_dialog_oversizeimage.show(),NHIE.workspace.setSize(l,c,!0),a=NHIE.workspace.getSize()}}else(l>n||c>i)&&(NHIE.dialog.alert_dialog_bigimage.show(),l>n&&(c=n*c/l,l=n),c>i&&(l=i*l/c,c=i));return{w:l,h:c,nw:nw,nh:nh,workspace_size:a}},setImageOnCanvas:function(e,t){!0===NHIE.config.option.ClearLayersWhenUploadImage&&NHIE.workspace.layers.length&&(NHIE.workspace.resetToInitialSize(),NHIE.workspace.reload({id_arr:[],skipEvent:!1}),NHIE.history.reset());var n=NHIE.workspace.addLayer("image"),i=n.getCanvasElement(),r=i.getContext("2d"),a=NHIE.util.getCanvasMaxWidth(),s=NHIE.util.getCanvasMaxHeight(),o=NHIE.workspace.getSize(),l=NHIE.lib.util.adjustUploadedImageSize(e,t);w=l.w,h=l.h,nw=l.nw,nh=l.nh,1===NHIE.workspace.layers.length?o=l.workspace_size:(w>a||h>s)&&(NHIE.dialog.alert_dialog_bigimage.show(),w>a&&(h=a*h/w,w=a),h>s&&(w=s*w/h,h=s)),i.width=w,i.height=h,console.log("---",w,h,nw,nh,e.naturalWidth,e.naturalHeight),t?r.drawImage(e,0,0,w,h):r.drawImage(e,0,0,nw,nh,0,0,w,h),NHIE.util.canvasCache.set(i);var c=w,d=h,u=o.width,p=o.height,f=c,g=d;n.setCanvasStyle({width:parseInt(f),height:parseInt(g),left:parseInt((u-f)/2),top:parseInt((p-g)/2)}),n.select(),n.empty=!1,NHIE.app.loading(!1),NHIE.app.fireEvent("changecontent")}},u=function(){var e=navigator.userAgent.toLowerCase(),t="",n=function(e){return e.replace(/(^\s*)|(\s*$)/g,"")};return a.IsIE?t=parseInt(a._bowser.version):a.IsGecko?t=e.substring(e.indexOf("firefox/")+8):a.IsOpera?t=n(-1!=e.indexOf("version/")?e.substring(e.indexOf("version/")+8):e.substring(0,e.indexOf("(")).replace("opera/","")):a.IsIOS5?t=e.match(/applewebkit\/(\d*)/)[1]:a.IsSafari?t=e.match(/version\/([\d|.]*)/i)[1]:a.IsChrome&&(t=parseInt(e.substring(e.indexOf("safari/")+7))),String(t)}(),p=function(){var e=navigator.userAgent.toLowerCase();return-1!=e.indexOf("linux")?"Linux":a.IsIOS5?"IOS5":-1!=e.indexOf("macintosh")?"Macintosh":-1!=e.indexOf("nt 6.0")?"Windows Vista/Server 2008":-1!=e.indexOf("nt 5.2")?"Windows Server 2003":-1!=e.indexOf("nt 5.1")?"Windows XP":-1!=e.indexOf("nt 5.0")?"Windows 2000":-1!=e.indexOf("nt")?"Windows NT":-1!=e.indexOf("9x 4.90")?"Windows Me":-1!=e.indexOf("98")?"Windows 98":-1!=e.indexOf("95")?"Windows 95":-1!=e.indexOf("win16")?"Windows 3.x":-1!=e.indexOf("windows")?"Windows":""}();return{err:{ERR_NO_IMAGE:"ERR_NO_IMAGE",ERR_FILE_SIZE_LIMIT:"ERR_FILE_SIZE_LIMIT",ERR_NO_FILE_SELECTED:"ERR_NO_FILE_SELECTED"},useragent:{info:a,version:u,os:p},cache:n,requirePromise:c,lang:i,tmpl:l,Promise:r,util:d}}),define("app/classes/Base",["underscore"],function(_){var initializing=!1,fnTest=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/,Class=function(){},__classes__={hash:{},parentmap:{}};Class.extend=function(prop,to){if(to){var from=prop,result=from.extend(to);return to.classname&&(__classes__.hash[to.classname]=result.prototype,__classes__.parentmap[to.classname]=from.prototype),result}prop.classname||(prop.classname="Class");var _super=this.prototype;initializing=!0;var prototype=new this;initializing=!1;for(var name in prop)prototype[name]="function"==typeof prop[name]&&"function"==typeof _super[name]&&fnTest.test(prop[name])?function(e,t){return function(){var n=this._super;this._super=_super[e];var i=t.apply(this,arguments);return this._super=n,i}}(name,prop[name]):prop[name];var str="function {{Class}}() {if(!initializing && this.construct )this.construct.apply(this, arguments);}{{Class}}.prototype = prototype;{{Class}}.prototype.constructor = {{Class}};{{Class}}.extend = arguments.callee;var tmp = {{Class}};";return str=str.replace(/{{Class}}/g,prop.classname),eval(str),__classes__.hash[prop.classname]=tmp.prototype,__classes__.parentmap[prop.classname]=this.prototype,tmp};var ClassManager=Class.extend({__classes_hash:__classes__.hash,__classes_parentmap:__classes__.parentmap,getClass:function(e){return this.__classes_hash[e]},getSuperclass:function(e){if(this.getClass(e))return this.__classes_parentmap[e]}});Class.classManager=new ClassManager,Class.define=function(e,t){t.classname=e;var n=this.classManager.getClass(t.extend);return delete t.extend,n.extend(t)};var level=0,indent=function(){for(var e="",t=0;t<level;t++)e+="   ";return e+level},extend_deeper=function e(t,n){return n&&_.each(n,function(n,i){if(void 0!==t[i])if("object"!=typeof t[i])t[i]=n;else{var r={};e(r,t[i]),r="object"==typeof n?e(r,n):n,t[i]=r}else t[i]=n}),t};_.extend_deeper=extend_deeper;var cls_uid=0,Base=Class.extend({classname:"Base",construct:function(e){this.initConfig={},_.extend(this,e),_.extend_deeper(this.initConfig,e),this.id=e.id||this.classname+"_"+cls_uid++},getConfig:function(){return this.initConfig},superclass:function(){return Class.classManager.getSuperclass(this.classname)},getAllProps:function(e){for(var t=this,n=[];t&&t.classname;)n.push(t),t=t.superclass();n.reverse();var i={};if(_.each(n,function(t){i=_.extend_deeper(i,t[e])}),!_.isEmpty(i))return i},init:function(){},destroy:function(){console.log("destroy!!!!!",this)}});return Base.classes=Class.classManager,Base}),define("app/classes/Observable",["underscore","app/classes/Base"],function(e,t){return t.extend({classname:"Observable",construct:function(e){this._super(e),this._events={},this._suspendedEvents={},this.init()},init:function(e){this.initEvents()},addEventListener:function(e,t,n){var i=this;i._events[e]||(i._events[e]=[]),i._events[e].push({scope:n,handler:t})},on:function(e,t,n){this.addEventListener(e,t,n)},fireEvent:function(e){var t,n=this;if(n._events[e]&&n._events[e].length>0)for(var i=0;i<n._events[e].length;i++){var r=n._events[e][i],a=!1;if(n._suspendedEvents[e]||(a=!0),a&&"function"==typeof r.handler){for(var s=[],i=0;i<arguments.length;i++)s.push(arguments[i]);s.shift(),t=r.handler.apply(r.scope||this,s)}}return t},suspendEvent:function(e){var t=this;t.classname==AppConstants.classname.Application?t._suspendedEvents[e]=!0:(t._suspendedEvents[e]=!0,t.events&&(t.events._suspended||(t.events._suspended={}),t.events._suspended[e]=!0))},resumeEvent:function(e){var t=this;t.classname==AppConstants.classname.Application?(t._suspendedEvents[e]=null,delete t._suspendedEvents[e]):(t._suspendedEvents[e]=null,t.events&&(t.events._suspended||(t.events._suspended={}),t.events._suspended[e]=null,delete t.events._suspended[e]))},getTarget:function(){return this.dom||null},initEvents:function(){var e=this,t=this.getAllProps("events");e.events=t,e.events&&$.each(e.events,function(t,n){e.addEventListener(t,n,e)})}})}),define("app/classes/ui/UIElement",["jquery","underscore","app/lib/promise","app/classes/Observable"],function(e,t,n,i){var r=0,a=i.extend({classname:"UIElement",defaultConfig:{renderTo:"body",template:{cls:"ui-element",tpl:""}},events:{render:function(){}},construct:function(n){n=n||{},n.renderTo=n.renderTo||this.renderTo||this.defaultConfig.renderTo;var i=JSON.parse(JSON.stringify(this.getAllProps("defaultConfig")||{}));n=t.extend_deeper(i,n);var a=this.template||{};a=t.extend_deeper(i.template,a),a=t.extend_deeper(a,n.template),n.template=a;if(!n.id&&!this.id){var s=0;for(s=r++;document.getElementById("ui-elements-"+ ++s););n.id="ui-elements-"+ ++s}this.rendered=!1,!!n.clearWrapper&&e(n.renderTo).html(""),this._super(n),this.fireEvent("construct",this)},init:function(e){this._super(e);var t=document.getElementById(this.id);t?(this.dom=t,this.rendered=!0):(this.rendered=!1,this.container&&this.render())},getDom:function(){return this.dom},getBody:function(){var t=e(this.dom),n=e(this.dom).find(">."+this.template.bodyCls);return 1==n.length?n.get(0):t.get(0)},setContent:function(t){var n=this.initConfig,i=n.renderTo;if("string"==typeof i?i=e(i):i instanceof a&&(i=e(renderTarget.getBody())),i.length){var r=t;"string"==typeof r&&(r=e(t).get(0)),r.id=this.id,i.get(0).appendChild(r),this.dom=r}},getTemplateConfig:function(){return this.initConfig.template},render:function(t){return t=t||this.initConfig,this.rendered&&this.dom?(this.fireEvent("render",e(this.com)),n.resolve(e(this.com))):(this.dom||(this.rendered=!1),new n(function(n,i){if(this.rendered)this.fireEvent("render",r);else{this.setContent(t.template.tpl),this.rendered=!0;var r=e(this.dom);this.fireEvent("render",r),n(r)}}.bind(this)))},setApplication:function(e){this._app=e},getApplication:function(){return this._app},destroy:function(){e(this.dom).off(),e(this.dom).remove(),this.dom=null}});return a}),define("app/classes/ui/Dialog",["jquery","underscore","app/classes/ui/UIElement"],function(e,t,n){return n.extend({classname:"Dialog",renderTo:".nhie-body",template:{tpl:'<div class="dialog"></div>'},events:{render:function(n){console.log(this);var i=this,r=e(i.dom),a=i.contentData||{};i.content=NHIE.tmpl(i.content,a),i.type=i.type||"alert","alert"===i.type?(i.buttons={},i.buttons[NHIE.Lang.PluginImageEditor_button_confirm]=function(){e(this).dialog("close")}):i.button_config&&i.button_config.length&&(i.buttons={},t.each(i.button_config,function(e){i.buttons[e.name]=e.action}));var s={title:i.title,draggable:!1,width:i.width||300,modal:!!i.modal,resizable:!!i.resizable,buttons:i.buttons||{}};i.destroyWhenClose?s.close=function(){e(this).dialog("close").remove(),"function"==typeof i.onClose&&i.onClose.apply(this)}:"function"==typeof i.onClose&&(s.close=i.onClose),r.html(i.content),r.dialog(s),i.onRenderDialog(r)}},construct:function(e){this._super(e)},show:function(e){return this.render()},hide:function(){},onRenderDialog:function(e){}})}),define("app/adapter/crosseditor",["jquery","underscore","app/lib","app/classes/ui/Dialog"],function(e,t,n,i){var r=n.Promise,a="kr";try{a="ko"==opener.NamoSELang.LangCode?"kr":opener.NamoSELang.LangCode||"kr"}catch(e){}var s=function(){var e={};try{e=opener.ce_ImageEditorPlugin}catch(e){throw console.error("error : opener is missing",e),e}return e};return{type:"crosseditor",localeCode:a,localeResource:{url:"../../../../js/lang/"+a,additional:"../resources/lang/"+a,shim:"NamoSELang"},init:function(e){},checkLicense:function(){return n.Promise.resolve(!0)},getUploadSizeLimit:function(){return opener.ce_ImageEditorPlugin._oThis.getUploadFileSizeLimit().image},getInitialData:function(){var e=s().getInitialData();this._initialData=e;var t={};return t.checkImageTitle=e.checkImageTitle,e.editImageURL?(t.src=e.editImageURL,t.width=e.editImageWidth,t.height=e.editImageHeight,0===t.src.indexOf("data:image/")?t.type="datasrc":t.type="url",t.title=e.imageTitle):t.type="none",t.CanvasWidth=800,t.CanvasHeight=600,t},upload:function(e){return e=e||{},e.type=(e.type||"").toLowerCase(),"form"===e.type?r.resolve(s().upload(e.data)).then(function(e){console.log(e);var t={};try{var i=JSON.parse(e);if(console.log(i),"success"===i.result){var r=i.addmsg[0],a=r.imageURL;a?(t.success=!0,t.src=a,t.width=r.imageOrgWidth,t.height=r.imageOrgHeight,t.size=r.imageSize):(t.success=!1,t.message=n.err.ERR_NO_IMAGE)}else switch(t.success=!1,t.result){case"invalid_size":t.message=n.err.ERR_FILE_SIZE_LIMIT;break;case"":t.message=""}}catch(e){console.error(e),t.message=n.err.ERR_NO_IMAGE}return t}):r.resolve()},onApply:function(){var t=(NHIE.workspace.getSize(),NHIE.adapter.getInitialData()),r="none"===t.type?"TEXT":"ITEM";n.Promise.resolve().then(function(){var r=n.Promise.resolve(t.title);if("true"===t.checkImageTitle&&!t.title){var a="<p>"+NHIE.Lang.PluginImageEditor_msg_accessibility+'</p><div><input type="text" style="width:100%;"/></div>';r=new n.Promise(function(t,n){var r=new i({title:"CrossPhoto",type:"dialog",width:400,content:a,modal:!0,button_config:[{name:NHIE.Lang.PluginImageEditor_button_confirm,action:function(){
var n=e(this),i=n.find("input"),r=i.val();r&&(t(r),e(this).dialog("close"))}}],onRenderDialog:function(e){var t=e.parent().find("button"),n=e.find("input");t.addClass("ui-state-disabled").attr("disabled","disabled"),n.off("keydown").on("keydown",function(){(n.val()||"").trim()?t.removeClass("ui-state-disabled").removeAttr("disabled"):t.addClass("ui-state-disabled").attr("disabled","disabled")}),n.focus()}});NHIE.app.loading(!1),r.show()})}return r}).then(function(e){return NHIE.app.__imageTitle=e||t.title,NHIE.app.loading(!0),NHIE.workspace.mergeLayers()}).then(function(e){var t=[];if("number"==typeof NHIE.config.option.ImageSaveJpegQuality){var i=NHIE.config.option.ImageSaveJpegQuality;t.push("image/jpeg"),(i<0||i>1)&&(console.warn('"ImageSaveJpegQuality" value should be between 0 and 1.(now set to '+i+") - set to default value: 0.7"),i=.7),t.push(i)}var a=e.toDataURL.apply(e,t),o=null;n.useragent.info.IsIE10||n.useragent.info.IsIE11||n.useragent.info.IsEdge,o=a;var l=o;return console.log(l),NHIE.adapter.upload({type:"form",data:l}).then(function(t){if(console.log(t),t.success){var n=t.src,i=t.size;s().execute({src:n,size:i,alt:NHIE.app.__imageTitle,width:e.width,height:e.height,mode:r})}}).catch(function(e){console.error(e)})}).catch(function(e){console.error(e)}).then(function(){NHIE.app.loading(!1)}).then(function(){window.close()})},onCancel:function(){console.log("close NHIE window");try{s().unmaskParent(),s().cancel(),window.close()}catch(e){}},onUnload:function(){s().unmaskParent()}}}),define("app/external_adapter_crosseditor",["underscore","app/adapter/crosseditor"],function(e,t){var n={crosseditor:t},i=function(){};return e.each(n,function(e){"function"!=typeof e.init&&(e.init=i),"function"!=typeof e.setLocaleCode&&(e.setLocaleCode=i)}),{get:function(e){return e=e||"crosseditor",n[e]||n.crosseditor}}}),define("text",["module"],function(e){"use strict";var t,n,i,r,a,s=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],o=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,l=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,c="undefined"!=typeof location&&location.href,d=c&&location.protocol&&location.protocol.replace(/\:/,""),u=c&&location.hostname,p=c&&(location.port||void 0),f={},h=e.config&&e.config()||{};return t={version:"2.0.14",strip:function(e){if(e){e=e.replace(o,"");var t=e.match(l);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:h.createXhr||function(){var e,t,n;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(t=0;t<3;t+=1){n=s[t];try{e=new ActiveXObject(n)}catch(e){}if(e){s=[n];break}}return e},parseName:function(e){var t,n,i,r=!1,a=e.lastIndexOf("."),s=0===e.indexOf("./")||0===e.indexOf("../");return-1!==a&&(!s||a>1)?(t=e.substring(0,a),n=e.substring(a+1)):t=e,i=n||t,a=i.indexOf("!"),-1!==a&&(r="strip"===i.substring(a+1),i=i.substring(0,a),n?n=i:t=i),{moduleName:t,ext:n,strip:r}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,i,r){var a,s,o,l=t.xdRegExp.exec(e);return!l||(a=l[2],s=l[3],s=s.split(":"),o=s[1],s=s[0],!(a&&a!==n||s&&s.toLowerCase()!==i.toLowerCase()||(o||s)&&o!==r))},finishLoad:function(e,n,i,r){i=n?t.strip(i):i,h.isBuild&&(f[e]=i),r(i)},load:function(e,n,i,r){if(r&&r.isBuild&&!r.inlineText)return void i();h.isBuild=r&&r.isBuild;var a=t.parseName(e),s=a.moduleName+(a.ext?"."+a.ext:""),o=n.toUrl(s),l=h.useXhr||t.useXhr;if(0===o.indexOf("empty:"))return void i();!c||l(o,d,u,p)?t.get(o,function(n){t.finishLoad(e,a.strip,n,i)},function(e){i.error&&i.error(e)}):n([s],function(e){t.finishLoad(a.moduleName+"."+a.ext,a.strip,e,i)})},write:function(e,n,i,r){if(f.hasOwnProperty(n)){var a=t.jsEscape(f[n]);i.asModule(e+"!"+n,"define(function () { return '"+a+"';});\n")}},writeFile:function(e,n,i,r,a){var s=t.parseName(n),o=s.ext?"."+s.ext:"",l=s.moduleName+o,c=i.toUrl(s.moduleName+o)+".js";t.load(l,i,function(n){var i=function(e){return r(c,e)};i.asModule=function(e,t){return r.asModule(e,c,t)},t.write(e,l,i,a)},a)}},"node"===h.env||!h.env&&"undefined"!=typeof process&&process.versions&&process.versions.node&&!process.versions["node-webkit"]&&!process.versions["atom-shell"]?(n=require.nodeRequire("fs"),t.get=function(e,t,i){try{var r=n.readFileSync(e,"utf8");"\ufeff"===r[0]&&(r=r.substring(1)),t(r)}catch(e){i&&i(e)}}):"xhr"===h.env||!h.env&&t.createXhr()?t.get=function(e,n,i,r){var a,s=t.createXhr();if(s.open("GET",e,!0),r)for(a in r)r.hasOwnProperty(a)&&s.setRequestHeader(a.toLowerCase(),r[a]);h.onXhr&&h.onXhr(s,e),s.onreadystatechange=function(t){var r,a;4===s.readyState&&(r=s.status||0,r>399&&r<600?(a=new Error(e+" HTTP status: "+r),a.xhr=s,i&&i(a)):n(s.responseText),h.onXhrComplete&&h.onXhrComplete(s,e))},s.send(null)}:"rhino"===h.env||!h.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java?t.get=function(e,t){var n,i,r=new java.io.File(e),a=java.lang.System.getProperty("line.separator"),s=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(r),"utf-8")),o="";try{for(n=new java.lang.StringBuffer,i=s.readLine(),i&&i.length()&&65279===i.charAt(0)&&(i=i.substring(1)),null!==i&&n.append(i);null!==(i=s.readLine());)n.append(a),n.append(i);o=String(n.toString())}finally{s.close()}t(o)}:("xpconnect"===h.env||!h.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(i=Components.classes,r=Components.interfaces,Components.utils.import("resource://gre/modules/FileUtils.jsm"),a="@mozilla.org/windows-registry-key;1"in i,t.get=function(e,t){var n,s,o,l={};a&&(e=e.replace(/\//g,"\\")),o=new FileUtils.File(e);try{n=i["@mozilla.org/network/file-input-stream;1"].createInstance(r.nsIFileInputStream),n.init(o,1,0,!1),s=i["@mozilla.org/intl/converter-input-stream;1"].createInstance(r.nsIConverterInputStream),s.init(n,"utf-8",n.available(),r.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),s.readString(n.available(),l),s.close(),n.close(),t(l.value)}catch(e){throw new Error((o&&o.path||"")+": "+e)}}),t}),define("text!resources/tpl/ui/ui-spinner.tpl.html",[],function(){return""}),define("app/launcher",["app/external_adapter_crosseditor","text!resources/tpl/ui/ui-spinner.tpl.html"],function(e,t){require(["text!app/app.config.json"],function(n){n=n||"{}";try{n=JSON.parse(n)}catch(e){n={}}window.NHIE={config:n};var i=n.default_adapter||"standalone";console.log("adapter name : ",i);var r=e.get(i);window.NHIE.adapter=r;var a=function(){document.querySelector("div.spinner").style.display="none",document.querySelector("div.message").style.display="none"},s=function(e){var i=document.createElement("div");i.innerHTML=t,document.body.appendChild(i);var s=function(e){require(["app/nhie"],function(t){console.log("launch NHIE",t,e),t.init(e),t.launch()})};require(["text!../crossphoto.config.json","text!./license.json"],function(t,i){t=t||"{}";try{t=JSON.parse(t)}catch(e){t={}}(e=e||{option:{}})&&e.option&&e.option.UploadFileSizeLimit&&(null===e.option.UploadFileSizeLimit||isNaN(e.option.UploadFileSizeLimit)||(e.option["upload-size-limit"]=e.option.UploadFileSizeLimit));if(n=_.extend(n,t,function(e){var t={};return["version","upload-size-limit","ImageSavePath","maxImageWidth","maxImageHeight","UploadFileNameType","UploadFileSubDir","UploadFileNameType","UploadFileExecutePath","UploadImageFileExtBlockList","WebsourcePath"].forEach(function(n){e[n]&&(t[n]=e[n])}),t}(e.option),e),console.warn("adapter init option:",n),r.init(n),r.localeResource&&r.localeResource.url){var o=n["default-language"]||"kr";r.setLocaleCode(o);var l=function(){r.checkLicense(i).then(function(e){!0===e?s(n):a()})};require([r.localeResource.url,r.localeResource.additional],function(e,t){r.localeResource.shim&&window[r.localeResource.shim]&&(e=window[r.localeResource.shim]),t&&(e=_.extend(e,t)),NHIE.Lang=e,l()})}else NHIE.Lang={},l()})};NHIE.start=s,"crosseditor"===r.type&&NHIE.start()})});